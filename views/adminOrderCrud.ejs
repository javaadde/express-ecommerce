<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css2?family=Michroma:wght@400&family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
            extend: {
                colors: {
                'off-white': '#fafafa',
                'off-black': '#1a1a1a',
                'soft-gray': '#f5f5f5',
                'dark-gray': '#2a2a2a'
                },
                fontFamily: {
                'michroma': ['Michroma', 'sans-serif'],
                'comfortaa': ['Comfortaa', 'sans-serif'],
                }
            }
            }
        }
    </script>
</head>
<body>

<section class="font-comfortaa p-6">
  <div class="bg-white rounded-xl shadow-xl w-full">

    <!-- Modal Content -->
    <div class="p-6">
      <div class="grid grid-cols-1 gap-8">

        <% details.items.forEach((item, idx) => { %>
        <!-- Order Items -->
        <div class="p-8">
          <h3 class="text-lg font-semibold text-off-black mb-4">
            Order Item <%= idx + 1 %>
          </h3>
          <div class="flex items-center space-x-4 p-4 bg-soft-gray rounded-lg flex-col md:flex-row">
            <img src="<%= item.url %>" alt="<%= item.name %>" class="w-26 h-36 rounded-lg object-cover">
            <div class="flex-1">
              <h4 class="font-semibold text-off-black"><%= item.name %></h4>
              <p class="text-dark-gray text-sm">
                <%= item.price %> &nbsp; x &nbsp; <%= item.quantity %>
              </p>
            </div>
            <div class="text-right pr-5">
              <p class="font-semibold text-off-black">
                Subtotal : &nbsp; <%= item.price * item.quantity %>
              </p>
            </div>
          </div>
        </div>
        <% }) %>

        <!-- Order Summary & Details -->
        <div class="lg:col-span-1 space-y-6 p-5">

          <!-- Order Summary -->
          <div class="bg-soft-gray rounded-xl p-4 px-8">
            <h3 class="text-lg font-semibold text-off-black mb-4">Order Summary</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-dark-gray">Subtotal</span>
                <span id="adminSubtotal" class="text-off-black">
                  <%= details.total - 5.99 %>
                </span>
              </div>
              <div class="flex justify-between">
                <span class="text-dark-gray">Shipping</span>
                <span id="adminShipping" class="text-off-black">
                  $5.99
                </span>
              </div>
              <div class="flex justify-between">
                <span class="text-dark-gray">Tax</span>
                <span id="adminTax" class="text-off-black">
                  $0.00
                </span>
              </div>
              <div class="border-t border-gray-300 pt-2 mt-2">
                <div class="flex justify-between font-semibold">
                  <span class="text-off-black">Total</span>
                  <span id="adminTotal" class="text-off-black">
                    <%= details.total %>
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Shipping Address -->
          <div class="bg-soft-gray rounded-xl p-4 px-8">
            <h3 class="text-lg font-semibold text-off-black mb-4">Shipping Address</h3>
            <div id="adminShippingAddress" class="text-sm text-dark-gray">
              <% for (const key in details.address) { %>
                <p>
                  <span class="font-bold"><%= key %>:</span>
                  &nbsp; <%= details.address[key] %>
                </p>
              <% } %>
            </div>
          </div>

          <!-- Order Status (Admin Editable) -->
          <div class="bg-soft-gray rounded-xl p-4 px-8 space-y-4">
            <h3 class="text-lg font-semibold text-off-black mb-2">Order Status</h3>
            <div class="flex items-center space-x-4">
              <select
                id="status-select"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-off-black"
              >
                <option value="placed"    <%= details.status === 'placed' ? 'selected' : '' %>>Placed</option>
                <option value="processing"<%= details.status === 'processing' ? 'selected' : '' %>>Processing</option>
                <option value="shipped"   <%= details.status === 'shipped' ? 'selected' : '' %>>Shipped</option>
                <option value="delivered" <%= details.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
                <option value="cancelled" <%= details.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
              </select>
              <button
                onclick="updateStatus('<%= details.id %>')"
                class="px-6 py-2 bg-off-black text-off-white rounded-lg hover:bg-dark-gray transition-colors font-medium"
              >
                Update Status
              </button>
            </div>
          </div>

          <!-- Delete Order -->
          <div class="bg-soft-gray rounded-xl p-4 px-8">
            <h3 class="text-lg font-semibold text-off-black mb-2">Danger Zone</h3>
            <button
              onclick="deleteOrder('<%= details.id %>')"
              class="px-6 py-2 text-red-600 underline font-bold hover:text-red-800 transition-colors"
            >
              Delete Order
            </button>
          </div>

        </div>
      </div>
    </div>

  </div>
</section>

<script>

  function updateStatus(orderId) {
    const newStatus = document.getElementById('status-select').value;
    fetch(`/admin/order/${orderId}/status`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: newStatus })
    })
    .then( async(res)=> {
      const data = await res.json()
      alert('Order status updated to ' + data.Status);
       window.location.reload();
    })
    .catch(err => {
      console.error(err);
      alert('Failed to update status');
    });
  }


  function deleteOrder(orderId) {
    if (!confirm('Are you sure you want to permanently delete this order?')) return;
    fetch(`/admin/order/delete/${orderId}`, {
      method:'DELETE',
      headers:{
        'Content-Type':'application/json'
      }
    })
    .then(async(res) => {
      const data = await res.json()
      alert(`Order ${data.msg}`);
      window.location.href = 'http://localhost:5000/admin/orders';
    })
    .catch(err => {
      console.error(err);
      alert('Failed to delete order');
    });
  }
</script>

    
</body>
</html>