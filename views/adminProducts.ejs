<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Products</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
      <link href="https://fonts.googleapis.com/css2?family=Michroma:wght@400&family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'off-white': '#fafafa',
                        'off-black': '#1a1a1a',
                        'soft-gray': '#f5f5f5',
                        'dark-gray': '#2a2a2a'
                    },
                    fontFamily: {
                        'michroma': ['Michroma', 'sans-serif'],
                        'comfortaa': ['Comfortaa', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-off-white min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-off-black rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-off-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-off-black font-michroma">Products</h1>
                </div>
                <!-- <button onclick="logout()" class="text-dark-gray hover:text-off-black font-medium">Logout</button> -->
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto p-6 font-comfortaa">
        <!-- Add New Product Section -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
            <h2 class="text-xl font-bold text-off-black mb-6">Add New Product</h2>
            
            <form id="productForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-dark-gray mb-2">Product ID</label>
                        <input 
                            type="text" 
                            id="productId"
                            placeholder="e.g., PROD001"
                            class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-dark-gray mb-2">Product Name</label>
                        <input 
                            type="text" 
                            id="productName"
                            placeholder="Enter product name"
                            class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all"
                        >
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-dark-gray mb-2">Price ($)</label>
                        <input 
                            type="number" 
                            id="productPrice"
                            placeholder="0.00"
                            step="0.01"
                            min="0"
                            class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-dark-gray mb-2">Category</label>
                        <select 
                            id="productCategory"
                            class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all"
                        >
                            <option value="">Select category</option>
                            <option value="Shirts">Shirts</option>
                            <option value="T-Shirts">T-Shirts</option>
                            <option value="Jeans">Jeans</option>
                            <option value="Jackets">Jackets</option>
                            <option value="Hoodies">Hoodies</option>
                        
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-dark-gray mb-2">Image URL</label>
                    <input 
                        type="url" 
                        id="productImage"
                        placeholder="https://example.com/image.jpg"
                        class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all"
                    >
                </div>

                <div class="flex justify-end pt-4">
                    <button 
                        type="button"
                        onclick="addProduct()"
                        class="px-6 py-3 bg-off-black text-off-white rounded-lg hover:bg-dark-gray transition-colors font-semibold"
                    >
                        Add Product
                    </button>
                </div>
            </form>
        </div>


        
        <!-- Products List -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-500">
            <div class="p-6 border-b border-gray-100 text-center">
                <h2 class="text-4xl font-bold text-off-black">Products</h2>
            </div>
            
            <div class="overflow-x-auto ">
                <table class="w-full">
                    <thead class="bg-soft-gray">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-dark-gray">Product ID</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-dark-gray">Image</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-dark-gray">Name</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-dark-gray">Price</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-dark-gray">Category</th>
                            <th class="px-6 py-4 text-center text-sm font-semibold text-dark-gray">Actions</th>
                        </tr>
                    </thead>

                    <% products.forEach((pro)=> { %>
                    <tbody id="productsTable" class="h-48 bg-[#F9F9F9] transition-all ease-in-out duration-300 border-t-[1px] border-gray-400 z-0">
                        <!-- Sample products will be added here -->

                        <td class="text-center rounded-bl-xl" value="<%= pro._id %>"><%= pro._id %></td>

                        <td  class="w-[20%]"> 
                            <img src="<%= pro.url %>" alt=""> 
                        </td>   

                        <td class="text-center"><%= pro.name %></td>     
                        <td class="text-center"><%= pro.price %></td>     
                        <td class="text-center"><%= pro.category %></td>

                        <td class="rounded-br-xl">
                            <div class="w-full flex flex-col justify-center items-center gap-6">
                              <button class="text-2xl hover:text-blue-600"
                                      onclick="editProduct(this)">
                               <i class="fa-solid fa-pen-to-square"></i>
                              </button>

                              <button class="text-2xl hover:text-blue-600"
                                onclick="deleteProduct(this)">
                              <i class="fa-solid fa-trash"></i>
                              </button>

                            </div>
                        </td>     

                    </tbody>
                    <% }) %>
                </table>
            </div>


        </div>
    </div>



    <!-- Edit Modal -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
            <h3 class="text-lg font-bold text-off-black mb-4">Edit Product</h3>
    
        <form action="" id="updateForm"> 

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-dark-gray mb-2">Product ID</label>
                    <input type="text" name="id" id="editProductId" class="w-full px-4 py-3 bg-soft-gray rounded-lg text-off-black" readonly >
                </div>

                <div>
                    <label class="block text-sm font-semibold text-dark-gray mb-2">Name</label>
                    <input type="text" name="name" class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-dark-gray mb-2">Price ($)</label>
                    <input type="number" name="price" class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-dark-gray mb-2">Image URL</label>
                    <input type="text" name="url" class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-dark-gray mb-2">Category</label>
                    <select name="category" class="w-full px-4 py-3 bg-soft-gray border-2 border-transparent rounded-lg text-off-black focus:outline-none focus:border-off-black focus:bg-white transition-all">

                            <option value="">default Category</option>
                            <option value="Shirts">Shirts</option>
                            <option value="T-Shirts">T-Shirts</option>
                            <option value="Jeans">Jeans</option>
                            <option value="Jackets">Jackets</option>
                            <option value="Hoodies">Hoodies</option>
                        
                    </select>
                </div>
            </div>

            <div class="flex justify-end space-x-3 mt-6">
                <button id="closeModal" class="px-4 py-2 border-2 border-off-black rounded-md text-dark-gray hover:text-off-black transition-colors">
                    Cancel
                </button>

                <button  type="submit" class="px-6 py-2 bg-off-black text-off-white rounded-lg hover:bg-dark-gray transition-colors font-medium">
                    Update
                </button>
            </div>

        </form>    

        </div>
    </div>

    <script>




    //    update products
        const form = document.getElementById('updateForm')
        form.addEventListener("submit", async(e)=>{
             e.preventDefault()

              const formData = new FormData(form)
              const data = Object.fromEntries(formData.entries())
               console.log(data);
               
               for (const key in data){
                   if(data[key] === ''){
                    delete data[key]
                   }
               }

               console.log(data);
               
               
        try {
             const response = await fetch("http://localhost:5000/admin/products/update", {
                 method:'PUT',
                 headers: {
                    'Content-Type': 'application/json'
                 },
                 body: JSON.stringify(data),
             })

        .then( async(response)=>{

            // Handle the response from the server
            const result = await response.json();
           
            // close modal
            document.getElementById('editModal').classList.add('hidden');
            // notification
            showNotification(result.message);
            // reload page
            setTimeout(()=>{
                location.reload()
            },1200)
        })


        } catch (error) {
         console.log(error);
        }
             
        })
    //    buttom calling to open modal    
        function editProduct(button) {

                const parentOne = button.parentNode;
                const parentTwo = parentOne.parentNode;
                const parentThree = parentTwo.parentNode;
                
                const pro_id = parentThree.firstChild.innerText;
                
                console.log(pro_id);
            
                document.getElementById('editProductId').value = pro_id;
                document.getElementById('editModal').classList.remove('hidden');
        }



     //   insert pro
        function addProduct() {
            const productId = document.getElementById('productId').value.trim();
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const image = document.getElementById('productImage').value.trim();
            const category = document.getElementById('productCategory').value;

            const product = {
                _id:productId,
                name:name,
                price:price,
                url:image,
                category:category,
            }


            // Validation
            if (!productId || !name || !price || !image || !category) {
                alert('Please fill in all fields');
                return;
            }

            

            // Add product
            fetch('http://localhost:5000/admin/products/add',{
                method:'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body:JSON.stringify(product)
            })
            .then( async(res) => {

                const data = await res.json()
                
                console.log(data);
                
                showNotification(data.message)
                 setTimeout(()=>{
                         location.reload()
                 },1000)
            })
            .catch((res)=>{
                showNotification(res.message)
            })

            // Clear form
            document.getElementById('productForm').reset();
            
            // Re-render table
            // renderProducts();
            
            // showNotification('Product added successfully!');
        }

     //   delete pro   
        function deleteProduct(button) {
            if (confirm('Are you sure you want to delete this product?')) {
                
                const parentOne = button.parentNode;
                const parentTwo = parentOne.parentNode;
                const parentThree = parentTwo.parentNode;
                
                const pro_id = parentThree.firstChild.innerText;
                
                console.log(pro_id);

                fetch('http://localhost:5000/admin/products/delete',{
                    method:'DELETE',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body:JSON.stringify( {
                        pro_id : pro_id,
                    })
                })
                .then(()=>{
                     showNotification('Product deleted successfully!');
                     setTimeout(()=>{
                         location.reload()
                     },1000)
                })
                .catch(()=>{
                     showNotification('cant delete the product')
                })

               
            }
        }


        // Notification modal animation
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-off-black text-off-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all transform translate-x-full';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }



        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('editModal');
            if (e.target === modal) {
                document.getElementById('editModal').classList.add('hidden');
            }
        });
        // close modal clicking cancel button
        document.getElementById('closeModal').addEventListener("click",()=>{
            document.getElementById('editModal').classList.add('hidden');
        })


    </script>

</body>
</html>